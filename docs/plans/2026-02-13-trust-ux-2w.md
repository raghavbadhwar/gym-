# Trust UX 2-Week Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Ship trust-first UX improvements across mobile, issuer, recruiter, and gateway that make verification strength, consent safety, and audit trails obvious in under two weeks.

**Architecture:** Add lightweight trust/proof metadata to API responses, then surface it consistently in UI (labels, reasons, and audit context). Keep changes additive and backward compatible with existing endpoints.

**Tech Stack:** React Native (Expo), React (Vite), Express, Drizzle/Postgres, React Query, Expo Haptics.

---

### Task 1: Add trust/proof metadata helpers (Issuer + Recruiter servers)

**Files:**
- Create: CredVerseIssuer 3/server/services/trust-metrics.ts
- Create: CredVerseRecruiter/server/services/trust-metrics.ts
- Test: CredVerseIssuer 3/tests/trust-metrics.test.ts
- Test: CredVerseRecruiter/tests/trust-metrics.test.ts

**Step 1: Write the failing tests**

```ts
import { describe, expect, it } from "vitest";
import { getTrustGrade, getProofStrength } from "../server/services/trust-metrics";

describe("trust-metrics", () => {
  it("grades trust by score", () => {
    expect(getTrustGrade(450)).toBe("unverified");
    expect(getTrustGrade(720)).toBe("silver");
    expect(getTrustGrade(910)).toBe("diamond");
  });

  it("calculates proof strength", () => {
    expect(getProofStrength({ issuerTrusted: true, revocationStatus: "active", anchorStatus: "anchored" }))
      .toBe("strong");
    expect(getProofStrength({ issuerTrusted: false, revocationStatus: "unknown", anchorStatus: "pending" }))
      .toBe("basic");
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/trust-metrics.test.ts
```
Expected: FAIL (module not found)

**Step 3: Write minimal implementation**

```ts
type TrustGrade = "unverified" | "bronze" | "silver" | "gold" | "platinum" | "diamond";

export function getTrustGrade(score: number | null): TrustGrade {
  if (score === null || score < 500) return "unverified";
  if (score < 650) return "bronze";
  if (score < 750) return "silver";
  if (score < 850) return "gold";
  if (score < 930) return "platinum";
  return "diamond";
}

export function getProofStrength(input: {
  issuerTrusted: boolean;
  revocationStatus: "active" | "revoked" | "unknown";
  anchorStatus: "anchored" | "pending";
}): "basic" | "strong" | "verified" {
  if (input.issuerTrusted && input.revocationStatus === "active" && input.anchorStatus === "anchored") {
    return "verified";
  }
  if (input.issuerTrusted && input.revocationStatus === "active") {
    return "strong";
  }
  return "basic";
}
```

**Step 4: Run test to verify it passes**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/trust-metrics.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add "CredVerseIssuer 3/server/services/trust-metrics.ts" "CredVerseIssuer 3/tests/trust-metrics.test.ts"
git commit -m "feat(issuer): add trust metrics helpers"
```

---

### Task 2: Add trust/proof metadata to Issuer API responses

**Files:**
- Modify: CredVerseIssuer 3/server/routes/verify.ts
- Modify: CredVerseIssuer 3/server/routes/reputation.ts
- Modify: docs/openapi/v1.yaml
- Test: CredVerseIssuer 3/tests/verify-trust-metadata.test.ts

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import request from "supertest";
import app from "../server/index";

describe("verify trust metadata", () => {
  it("adds trust_grade and proof_strength", async () => {
    const res = await request(app).get("/api/v1/verify?vc=demo");
    expect(res.body.trust_grade).toBeDefined();
    expect(res.body.proof_strength).toBeDefined();
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/verify-trust-metadata.test.ts
```
Expected: FAIL (missing fields)

**Step 3: Write minimal implementation**

- In verify responses, add `trust_grade`, `proof_strength`, and `trust_reasons` based on signature validity and revocation.
- In reputation score response, include `trust_grade` derived from the score.

**Step 4: Update OpenAPI**

- Add new fields to `VerifyResponse` and `ReputationScoreResponse` schemas.

**Step 5: Run test to verify it passes**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/verify-trust-metadata.test.ts
```
Expected: PASS

**Step 6: Commit**

```
git add "CredVerseIssuer 3/server/routes/verify.ts" "CredVerseIssuer 3/server/routes/reputation.ts" "docs/openapi/v1.yaml"
git commit -m "feat(issuer): add trust metadata to verify and reputation"
```

---

### Task 3: Add trust/proof metadata to Recruiter verification API

**Files:**
- Modify: CredVerseRecruiter/server/routes/verification.ts
- Test: CredVerseRecruiter/tests/verification-trust-metadata.test.ts

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import request from "supertest";
import app from "../server/index";

describe("verification trust metadata", () => {
  it("returns proof_strength and trust_grade", async () => {
    const res = await request(app).post("/api/verify/simulate").send({});
    expect(res.body.v1.proof_strength).toBeDefined();
    expect(res.body.v1.trust_grade).toBeDefined();
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd "CredVerseRecruiter" && npm test -- --run tests/verification-trust-metadata.test.ts
```
Expected: FAIL (missing fields)

**Step 3: Write minimal implementation**

- Add `proof_strength`, `trust_grade`, and `trust_reasons` to the `v1` block in the response using the trust-metrics helper.

**Step 4: Run test to verify it passes**

Run:
```
cd "CredVerseRecruiter" && npm test -- --run tests/verification-trust-metadata.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add "CredVerseRecruiter/server/routes/verification.ts" "CredVerseRecruiter/tests/verification-trust-metadata.test.ts"
git commit -m "feat(recruiter): add trust metadata to verification response"
```

---

### Task 4: Mobile trust cards, consent creation, and audit timeline

**Files:**
- Modify: apps/mobile/src/lib/api-client.ts
- Modify: apps/mobile/src/screens/holder-dashboard-screen.tsx
- Modify: apps/mobile/src/screens/connections-screen.tsx
- Modify: apps/mobile/src/screens/activity-screen.tsx
- Modify: apps/mobile/src/screens/settings-screen.tsx

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import { buildActivityItems } from "../src/lib/activity-builder";

describe("activity builder", () => {
  it("returns consent and data request entries", () => {
    const items = buildActivityItems([{ id: "1", created_at: "2025-01-01" } as any], []);
    expect(items.length).toBe(1);
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd apps/mobile && npm test -- --run activity-builder.test.ts
```
Expected: FAIL (module not found)

**Step 3: Write minimal implementation**

- Add `createHolderConsent` + `getHolderAuditTimeline` helpers in api-client.
- Add `buildActivityItems` helper to map consents/data requests to timeline rows.
- Update Connections confirm flow to call consent create API and show a success toast.
- Update Activity screen to render real items instead of empty list.
- Add trust grade chip and “Why trusted” card on Holder dashboard using `reputation.trust_grade` and `reputation.trust_reasons`.
- Add data minimization summary in consent preview.

**Step 4: Run test to verify it passes**

Run:
```
cd apps/mobile && npm test -- --run activity-builder.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add apps/mobile/src/lib/api-client.ts apps/mobile/src/lib/activity-builder.ts apps/mobile/src/screens/*.tsx
 git commit -m "feat(mobile): surface trust cards and audit timeline"
```

---

### Task 5: Issuer portal trust widgets (consent health + trust impact)

**Files:**
- Modify: CredVerseIssuer 3/client/src/pages/Dashboard.tsx
- Modify: CredVerseIssuer 3/client/src/pages/verification-logs.tsx

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import { formatTrustImpact } from "../src/lib/trust-impact";

describe("trust impact", () => {
  it("formats trust deltas", () => {
    expect(formatTrustImpact(12)).toBe("+12");
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/trust-impact.test.ts
```
Expected: FAIL (module not found)

**Step 3: Write minimal implementation**

- Add a “Consent Health” widget (active, expiring soon, revoked last 7 days) using `/api/v1/compliance/consents`.
- Add “Trust Impact” widget showing recent verification outcomes and trust delta.
- In verification logs, surface new `proof_strength`/`trust_grade` fields where available.

**Step 4: Run test to verify it passes**

Run:
```
cd "CredVerseIssuer 3" && npm test -- --run tests/trust-impact.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add "CredVerseIssuer 3/client/src/pages/Dashboard.tsx" "CredVerseIssuer 3/client/src/pages/verification-logs.tsx"
git commit -m "feat(issuer-ui): add consent health and trust impact widgets"
```

---

### Task 6: Recruiter portal trust reasons and proof strength

**Files:**
- Modify: CredVerseRecruiter/client/src/pages/InstantVerify.tsx
- Modify: CredVerseRecruiter/client/src/pages/Dashboard.tsx

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import { getTrustBadge } from "../src/lib/trust-badges";

describe("trust badges", () => {
  it("maps proof strength to badge text", () => {
    expect(getTrustBadge("verified").label).toBe("Verified Proof");
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd "CredVerseRecruiter" && npm test -- --run tests/trust-badges.test.ts
```
Expected: FAIL (module not found)

**Step 3: Write minimal implementation**

- Add a “Why trusted” section in InstantVerify results using `trust_reasons`.
- Display `proof_strength` badge and `trust_grade` chip near confidence.
- In dashboard, add a compact “Trust Quality” stat block that uses recent averages.

**Step 4: Run test to verify it passes**

Run:
```
cd "CredVerseRecruiter" && npm test -- --run tests/trust-badges.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add "CredVerseRecruiter/client/src/pages/InstantVerify.tsx" "CredVerseRecruiter/client/src/pages/Dashboard.tsx"
git commit -m "feat(recruiter-ui): show trust reasons and proof strength"
```

---

### Task 7: Gateway trust messaging on portal selection

**Files:**
- Modify: credverse-gateway/src/App.tsx

**Step 1: Write the failing test**

```ts
import { describe, expect, it } from "vitest";
import { buildTrustCopy } from "../src/lib/trust-copy";

describe("trust copy", () => {
  it("returns a short trust line", () => {
    expect(buildTrustCopy()).toContain("Verified");
  });
});
```

**Step 2: Run test to verify it fails**

Run:
```
cd credverse-gateway && npm test -- --run tests/trust-copy.test.ts
```
Expected: FAIL (module not found)

**Step 3: Write minimal implementation**

- Add a compact trust banner below portal cards (“Verified by issuer registry • Revocation checked • Audit logged”).

**Step 4: Run test to verify it passes**

Run:
```
cd credverse-gateway && npm test -- --run tests/trust-copy.test.ts
```
Expected: PASS

**Step 5: Commit**

```
git add credverse-gateway/src/App.tsx
 git commit -m "feat(gateway): add trust banner to portal selection"
```

---

### Task 8: Documentation and verification

**Files:**
- Modify: docs/openapi/v1.yaml
- Modify: docs/plans/2026-02-13-trust-ux-2w.md

**Step 1: Validate OpenAPI**

Run:
```
cd docs && npm test
```
Expected: PASS

**Step 2: Update plan with actual changes**

- Add a short “Implemented vs Planned” section.

**Step 3: Commit**

```
git add docs/openapi/v1.yaml docs/plans/2026-02-13-trust-ux-2w.md
git commit -m "docs: update trust UX plan and openapi"
```

---

## Notes
- Baseline tests currently fail in the worktree: `BlockWalletDigi` is missing `vitest` until its dependencies are installed.
- Ensure ALLOW_DEMO_ROUTES is not enabled in production per infra guidance.

---

**Plan complete and saved to** `docs/plans/2026-02-13-trust-ux-2w.md`.

Two execution options:

**1. Subagent-Driven (this session)** - I dispatch fresh subagent per task, review between tasks, fast iteration

**2. Parallel Session (separate)** - Open new session with executing-plans, batch execution with checkpoints

Which approach?
